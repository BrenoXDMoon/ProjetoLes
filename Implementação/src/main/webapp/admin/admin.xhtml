<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">
	<h:head>
	    <meta charset="UTF-8"/>
	    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <link href="#{request.contextPath}/assets/css/style.css" rel="stylesheet"/>
	    <link href="#{request.contextPath}/assets/css/bootstrap.min.css" rel="stylesheet"/>
	    <title>Admin</title>
	</h:head>
	
	<body class="bg-dark text-white">
	    <header class="site-header  py-1">
	        <nav class="container d-flex flex-column flex-md-row justify-content-between">
	            <a class="py-2 d-none d-md-inline-block" href="#{request.contextPath}/index.xhtml">NewStation</a>
	        </nav>
	    </header>
	    <section class="container mt-5">
	        <div class="row">
	            <div class="col-10">
	                <a class="py-2 d-none d-md-inline-block" href="#{request.contextPath}/admin/cartas/lista.xhtml"><button class="btn btn-info">Lista de Cartas</button></a>
	                <a class="py-2 d-none d-md-inline-block" href="#{request.contextPath}/admin/pedido/lista.xhtml"><button class="btn btn-info">Lista de Pedidos</button></a>
	                <a class="py-2 d-none d-md-inline-block" href="#{request.contextPath}/admin/cliente/lista.xhtml"><button class="btn btn-info">Lista de Clientes</button></a>
	                <div class="col-3">
	                
          	    <h:form enctype="multipart/form-data">
          	    <div class="col-8 pl-0">
          	    
			  		<h:outputLabel value="Primeira data" />
						<h:inputText value='#{grafico.min}'
						id="min" styleClass="form-control" />
					<h:outputLabel value="Segunda data" />
						<h:inputText value='#{grafico.max}'
						id="max" styleClass="form-control" />
				</div>
				<div class="mt-3">
					<h:selectOneMenu value="#{grafico.filtro}" class="form-select"> 
						<f:selectItem itemValue = "cartas" itemLabel = "Carta" /> 
           				<f:selectItem itemValue = "raridade" itemLabel = "Raridade" /> 
					</h:selectOneMenu>
					<h:selectOneMenu  value = "#{grafico.limitador}" class="ml-3" rendered="false"> 
						   <f:selectItem itemValue = "0" itemLabel = "Todos" /> 
						   <f:selectItem itemValue = "5" itemLabel = "5" /> 
						   <f:selectItem itemValue = "10" itemLabel = "10" />
						</h:selectOneMenu >
					</div>
					<h:commandButton value='Filtrar'
						action='#{grafico.setData}'
						styleClass="btn btn-primary my-3" /> 
				</h:form>
				</div>
					<div>
						<canvas id="myChart" style = "width:500px height:500px"></canvas>
					</div>
					
	            </div>
	            
	        </div>
	      
		
	    </section>
	   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	    <script>
		const c = #{grafico.json};
		var lista = [];
	    const teste = {
	    		datas:['January','February','March','April','May','June'],
		    	cartas:[{label: 'My First dataset', data: [0, 10, 5, 2, 20, 30, 45]},
			    	{label: 'My Second dataset',data: [02, 14, 55, 22, 30, 70, 15]},
			    	{label: 'My Third dataset',data: [10, 14, 35, 12, 40, 66, 25]}]
	    }
	    
// 	    myFunction(Object.keys(c.label),Object.values(c.label))
	    myFunction(c.limitador ,Object.keys(c.label),Object.values(c.label));
	    
	    function myFunction(limitador, label, data) {
	    	if(limitador == 0){
	    		limitador = label.length;
	    	}
	    	for (i = 0; i &lt; limitador ; i++){
	    		var cor = getRandomColor();
	    		var cartas = {"label":label[i], "data":data[i], "backgroundColor":cor ,"borderColor":cor};
	    		lista.push(cartas);
	    	}
	    }
	    
	    function getRandomColor() {
            var letters = '0123456789ABCDEF'.split('');
            var color = '#';
            for (var i = 0; i &lt; 6; i++ ) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
	    
	    const labels = c["datas"];
	    	const data = {
	    	  labels: labels,
	    	  datasets: lista
	    	  
	    	};
    	const config = {
    			  type: 'line',
    			  data,
    			  options: {borderColor:'#4BC0C0'}
    			};
    	var myChart = new Chart(
    		    document.getElementById('myChart'),
    		    config
    		  );
		</script>
	</body>
</html>